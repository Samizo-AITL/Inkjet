<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: 'ja' }}">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
    <title>{{ page.title | default: site.title }}</title>
    <meta name="description" content="{{ page.description | default: site.description }}">
    <meta name="color-scheme" content="light" />
    <link rel="canonical" href="{{ page.url | absolute_url }}" />

    <!-- 基本CSS（キャッシュバスター付き） -->
    <link rel="stylesheet"
          href="{{ '/assets/css/style.css' | relative_url }}?v={{ site.time | date: '%s' }}" />

    <!-- 追加CSS（_config.yml の extra_css に列挙されていれば順次読込） -->
    {% if site.extra_css %}
      {% for css in site.extra_css %}
        <link rel="stylesheet"
              href="{{ css | absolute_url | default: (css | relative_url) }}?v={{ site.time | date: '%s' }}">
      {% endfor %}
    {% endif %}
  </head>

  <!-- ★ ポータル統一トーン：セピア固定 -->
  <body class="theme-sepia">
    <main class="page-content" aria-label="Content">
      <div class="wrapper" style="max-width:980px;margin:0;padding:1.5rem 1rem;">
        {{ content }}
      </div>
    </main>

    <!-- Mermaid（```mermaid を自動描画。未使用でも無害） -->
    <script defer src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        // 1) code を div.mermaid に置換（pre > code.mermaid / code.language-mermaid の両方対応）
        document.querySelectorAll('pre > code.mermaid, pre > code.language-mermaid, code.language-mermaid')
          .forEach(function (code) {
            const pre = code.closest('pre');
            const div = document.createElement('div');
            div.className = 'mermaid';
            div.textContent = code.textContent;
            (pre || code).replaceWith(div);
          });

        // 2) ライト固定で初期化
        if (window.mermaid) {
          mermaid.initialize({ startOnLoad: true, theme: 'default', securityLevel: 'loose' });
        }
      });
    </script>
  </body>
</html>
